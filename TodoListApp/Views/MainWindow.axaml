<Window
    Height="700"
    Icon="/Assets/icons8-tasklist.png"
    MinHeight="550"
    MinWidth="800"
    Title="StudyBuddy - Your Todo Companion"
    Width="900"
    d:DesignHeight="700"
    d:DesignWidth="800"
    mc:Ignorable="d"
    x:Class="TodoListApp.Views.MainWindow"
    x:CompileBindings="True"
    x:DataType="vm:MainWindowViewModel"
    xmlns="https://github.com/avaloniaui"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:TodoListApp.ViewModels"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Grid>
        <Grid.Background>
            <StaticResource ResourceKey="BackgroundGradientBrush" />
        </Grid.Background>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="550" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <Border
            Background="{StaticResource PrimaryBrush}"
            BoxShadow="{StaticResource HeaderShadow}"
            CornerRadius="0,0,24,24"
            Grid.Row="0"
            Padding="24,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel
                    Grid.Column="0"
                    Orientation="Vertical"
                    VerticalAlignment="Center">
                    <TextBlock
                        FontSize="28"
                        FontWeight="Bold"
                        Foreground="White"
                        Margin="0,0,0,4"
                        Text="StudyBuddy ðŸŽ“" />
                    <TextBlock
                        FontSize="14"
                        Foreground="{StaticResource PrimaryLightBrush}"
                        Text="Your personal productivity companion" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <!--  Quick Stats  -->
                    <Border Classes="header-card">
                        <StackPanel Spacing="8">
                            <TextBlock
                                FontSize="16"
                                FontWeight="Bold"
                                Foreground="{StaticResource TextPrimaryBrush}"
                                HorizontalAlignment="Center"
                                Text="Today's Progress" />
                            <Grid Margin="10,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock
                                        FontSize="20"
                                        FontWeight="Bold"
                                        Foreground="{StaticResource TextWhiteBrush}"
                                        HorizontalAlignment="Center"
                                        Text="{Binding TotalTasksCount}" />
                                    <TextBlock
                                        FontSize="12"
                                        Foreground="{StaticResource TextSecondaryBrush}"
                                        HorizontalAlignment="Center"
                                        Text="Total" />
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="20,0">
                                    <TextBlock
                                        FontSize="20"
                                        FontWeight="Bold"
                                        Foreground="{StaticResource HighPriorityColor}"
                                        HorizontalAlignment="Center"
                                        Text="{Binding PendingTasksCount}" />
                                    <TextBlock
                                        FontSize="12"
                                        Foreground="{StaticResource TextSecondaryBrush}"
                                        HorizontalAlignment="Center"
                                        Text="Pending" />
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock
                                        FontSize="20"
                                        FontWeight="Bold"
                                        Foreground="{StaticResource SuccessBrush}"
                                        HorizontalAlignment="Center"
                                        Text="{Binding CompletedTasksCount}" />
                                    <TextBlock
                                        FontSize="12"
                                        Foreground="{StaticResource TextSecondaryBrush}"
                                        HorizontalAlignment="Center"
                                        Text="Completed" />
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>

        <!--  Main Content  -->
        <Grid Grid.Row="1" Margin="24,24,24,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!--  Left Panel - Add Task  -->
            <Border
                Classes="card-container"
                Grid.Column="0"
                Margin="0,0,12,0">
                <ScrollViewer Margin="-15,0,-10,0" VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="8,0,20,0" Spacing="16">
                        <TextBlock
                            FontSize="20"
                            FontWeight="Bold"
                            Foreground="{StaticResource TextPrimaryBrush}"
                            Text="Add New Task" />

                        <TextBox
                            Classes="modern-input"
                            FontSize="16"
                            Text="{Binding NewTaskTitle}"
                            Watermark="What needs to be done?" />

                        <TextBox
                            AcceptsReturn="True"
                            Classes="modern-input"
                            Height="80"
                            Text="{Binding NewTaskDescription}"
                            Watermark="Add a description (optional)" />

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock
                                FontWeight="SemiBold"
                                Grid.Column="0"
                                Grid.Row="0"
                                Margin="0,0,0,8"
                                Text="Priority" />
                            <ComboBox
                                Classes="modern-combo"
                                Grid.Column="0"
                                Grid.Row="1"
                                ItemsSource="{Binding TaskPriorityList}"
                                Margin="0,0,8,0"
                                SelectedIndex="{Binding NewTaskPriority}" />

                            <TextBlock
                                FontWeight="SemiBold"
                                Grid.Column="1"
                                Grid.Row="0"
                                Margin="0,0,0,8"
                                Text="Category" />
                            <ComboBox
                                Classes="modern-combo"
                                Grid.Column="1"
                                Grid.Row="1"
                                ItemsSource="{Binding TaskCategoriesList}"
                                Margin="8,0,0,0"
                                SelectedIndex="{Binding NewTaskCategory}" />
                        </Grid>

                        <StackPanel Orientation="Vertical" Spacing="8">
                            <TextBlock FontWeight="SemiBold" Text="Due Date" />
                            <CalendarDatePicker
                                Background="{StaticResource BackgroundInputBrush}"
                                Classes="custom"
                                CornerRadius="12"
                                Foreground="{StaticResource TextPrimaryBrush}"
                                HorizontalAlignment="Stretch"
                                Padding="16,12"
                                SelectedDate="{Binding NewTaskDueDate}" />
                        </StackPanel>

                        <Button
                            Classes="modern-btn"
                            Command="{Binding AddTaskCommand}"
                            Content="{Binding ButtonText}"
                            FontSize="16"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            Margin="0,8,0,0" />

                        <Button
                            Classes="cancel-btn"
                            Command="{Binding CancelTaskCommand}"
                            Content="Cancel"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            IsVisible="{Binding SelectedTask, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                            Margin="0,8,0,0" />

                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!--  Right Panel - Task List  -->
            <Border
                Classes="card-container"
                Grid.Column="1"
                Margin="12,0,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!--  Task List Header  -->
                    <Grid Grid.Row="0" Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock
                            FontSize="20"
                            FontWeight="Bold"
                            Foreground="{StaticResource TextPrimaryBrush}"
                            Grid.Column="0"
                            Text="Your Tasks"
                            VerticalAlignment="Center" />

                        <StackPanel
                            Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="8">
                            <ComboBox
                                Classes="modern-combo"
                                MinWidth="120"
                                SelectedIndex="{Binding FilterIndex}">
                                <ComboBoxItem Content="All Tasks" />
                                <ComboBoxItem Content="Pending" />
                                <ComboBoxItem Content="Completed" />
                                <ComboBoxItem Content="High Priority" />
                            </ComboBox>
                            <Button
                                Classes="modern-btn"
                                Command="{Binding ClearAllTasksCommand}"
                                Content="Clear All"
                                FontSize="12"
                                Padding="12,8" />
                        </StackPanel>
                    </Grid>

                    <!--  Progress Bar  -->
                    <Border
                        Classes="progress-container"
                        Grid.Row="1"
                        Margin="0,0,0,16">
                        <Border Classes="progress-bar" Width="{Binding ProgressPercentage, Converter={StaticResource ProgressToWidthConverter}}" />
                    </Border>

                    <!--  Task List  -->
                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <ListBox
                                Classes="compact"
                                ItemsSource="{Binding FilteredTasks}"
                                SelectedItem="{Binding SelectedTask}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Classes="task-card">
                                            <Grid
                                                ColumnDefinitions="Auto,*,Auto"
                                                RowDefinitions="Auto,Auto, Auto"
                                                RowSpacing="3">
                                                <CheckBox
                                                    Classes="modern-check"
                                                    Grid.Column="0"
                                                    Grid.Row="0"
                                                    Grid.RowSpan="3"
                                                    IsChecked="{Binding IsCompleted}"
                                                    Margin="0,4,10,0"
                                                    VerticalAlignment="Center" />

                                                <TextBlock
                                                    FontSize="16"
                                                    FontWeight="SemiBold"
                                                    Foreground="{Binding IsCompleted, Converter={StaticResource BoolToForegroundConverter}}"
                                                    Grid.Column="1"
                                                    Grid.ColumnSpan="2"
                                                    Grid.Row="0"
                                                    Text="{Binding Title}"
                                                    TextDecorations="{Binding IsCompleted, Converter={StaticResource BoolToTextDecorationConverter}}" />

                                                <TextBlock
                                                    FontSize="14"
                                                    Foreground="{StaticResource TextSecondaryBrush}"
                                                    Grid.Column="1"
                                                    Grid.ColumnSpan="2"
                                                    Grid.Row="1"
                                                    IsVisible="{Binding Description, Converter={StaticResource StringNotEmptyConverter}}"
                                                    Margin="0,4,0,0"
                                                    Text="{Binding Description}" />

                                                <StackPanel
                                                    Grid.Column="1"
                                                    Grid.Row="2"
                                                    Margin="0,8,0,0"
                                                    Orientation="Horizontal"
                                                    Spacing="8">
                                                    <TextBlock
                                                        Classes="tag"
                                                        FontWeight="SemiBold"
                                                        Foreground="{Binding Priority, Converter={StaticResource PriorityToColorConverter}}"
                                                        Text="{Binding Priority}"
                                                        VerticalAlignment="Center" />
                                                    <TextBlock
                                                        Classes="tag"
                                                        FontSize="12"
                                                        FontWeight="SemiBold"
                                                        Padding="8,4"
                                                        Text="{Binding Category}" />
                                                    <TextBlock
                                                        Classes="tag"
                                                        FontSize="12"
                                                        FontWeight="SemiBold"
                                                        Foreground="{Binding DueDate, Converter={StaticResource DateToColorConverter}}"
                                                        Padding="8,4"
                                                        Text="{Binding DueDate, StringFormat='{}{0:MMM dd}'}" />
                                                </StackPanel>

                                                <Button
                                                    Classes="delete-btn"
                                                    Command="{Binding $parent[ListBox].((vm:MainWindowViewModel)DataContext).DeleteTaskCommand}"
                                                    CommandParameter="{Binding}"
                                                    Content="Delete"
                                                    Grid.Column="2"
                                                    Grid.Row="2"
                                                    IsVisible="{Binding IsSelected}"
                                                    Margin="0,8,0,0"
                                                    VerticalAlignment="Top" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>