<Window
    Height="650"
    Icon="/Assets/avalonia-logo.ico"
    MinHeight="500"
    MinWidth="600"
    Title="StudyBuddy - Your Todo Companion"
    Width="900"
    d:DesignHeight="600"
    d:DesignWidth="800"
    mc:Ignorable="d"
    x:Class="TodoListApp.Views.MainWindow"
    x:DataType="vm:MainWindowViewModel"
    xmlns="https://github.com/avaloniaui"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:TodoListApp.ViewModels"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Window.Styles>
        <!--  Base colors  -->
        <Style Selector="TextBlock">
            <Setter Property="Foreground" Value="#E0E0E0" />
        </Style>

        <!--  Base button style  -->
        <Style Selector="Button.modern-btn">
            <Setter Property="Background" Value="#6366F1" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="16,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <!--  Button hover effects  -->
        <Style Selector="Button.modern-btn:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#5B5CF6" />
        </Style>

        <!--  Button pressed effects  -->
        <Style Selector="Button.modern-btn:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="#4F46E5" />
        </Style>

        <!--  Delete button style  -->
        <Style Selector="Button.delete-btn">
            <Setter Property="Background" Value="#EF4444" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <!--  Delete button hover  -->
        <Style Selector="Button.delete-btn:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#DC2626" />
        </Style>

        <!--  TextBox style  -->
        <Style Selector="TextBox.modern-input">
            <Setter Property="Background" Value="#2D2D2D" />
            <Setter Property="Foreground" Value="#E0E0E0" />
            <Setter Property="BorderBrush" Value="#3E3E3E" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="16,12" />
            <Setter Property="FontSize" Value="14" />
        </Style>

        <!--  TextBox focus style  -->
        <Style Selector="TextBox.modern-input:focus">
            <Setter Property="BorderBrush" Value="#6366F1" />
        </Style>

        <!--  ComboBox style  -->
        <Style Selector="ComboBox.modern-combo">
            <Setter Property="Background" Value="#2D2D2D" />
            <Setter Property="Foreground" Value="#E0E0E0" />
            <Setter Property="BorderBrush" Value="#3E3E3E" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="16,12" />
            <Setter Property="FontSize" Value="14" />
        </Style>

        <!--  Task card style  -->
        <Style Selector="Border.task-card">
            <Setter Property="Background" Value="#252525" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,8" />
            <Setter Property="BoxShadow" Value="0 2 8 0 #00000060" />
        </Style>

        <!--  Task card hover  -->
        <Style Selector="Border.task-card:pointerover">
            <Setter Property="BoxShadow" Value="0 4 16 0 #00000080" />
            <Setter Property="Background" Value="#2D2D2D" />
        </Style>

        <!--  CheckBox style  -->
        <Style Selector="CheckBox.modern-check">
            <Setter Property="Margin" Value="0,0,12,0" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>

        <!--  Priority styles  -->
        <Style Selector="TextBlock.priority-high">
            <Setter Property="Background" Value="#422B2B" />
            <Setter Property="Foreground" Value="#FF6B6B" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <Style Selector="TextBlock.priority-medium">
            <Setter Property="Background" Value="#423D2B" />
            <Setter Property="Foreground" Value="#FFD166" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <Style Selector="TextBlock.priority-low">
            <Setter Property="Background" Value="#2B4237" />
            <Setter Property="Foreground" Value="#06D6A0" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <!--  Category styles  -->
        <Style Selector="TextBlock.category-academic">
            <Setter Property="Background" Value="#2B3A42" />
            <Setter Property="Foreground" Value="#6BB9FF" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="FontSize" Value="12" />
        </Style>

        <Style Selector="TextBlock.category-personal">
            <Setter Property="Background" Value="#3D2B42" />
            <Setter Property="Foreground" Value="#C97BFF" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="FontSize" Value="12" />
        </Style>

        <Style Selector="TextBlock.category-work">
            <Setter Property="Background" Value="#423D2B" />
            <Setter Property="Foreground" Value="#FFD166" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="FontSize" Value="12" />
        </Style>

        <Style Selector="TextBlock.category-health">
            <Setter Property="Background" Value="#2B4237" />
            <Setter Property="Foreground" Value="#06D6A0" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="FontSize" Value="12" />
        </Style>
    </Window.Styles>

    <Grid>
        <Grid.Background>
            <LinearGradientBrush EndPoint="100%,100%" StartPoint="0%,0%">
                <GradientStop Color="#121212" Offset="0" />
                <GradientStop Color="#1A1A1A" Offset="1" />
            </LinearGradientBrush>
        </Grid.Background>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="500" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <Border
            Background="#6366F1"
            CornerRadius="0,0,24,24"
            Grid.Row="0"
            Padding="24,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel
                    Grid.Column="0"
                    Orientation="Vertical"
                    VerticalAlignment="Center">
                    <TextBlock
                        FontSize="28"
                        FontWeight="Bold"
                        Foreground="White"
                        Margin="0,0,0,4"
                        Text="StudyBuddy ðŸŽ“" />
                    <TextBlock
                        FontSize="14"
                        Foreground="#C7D2FE"
                        Text="Your personal productivity companion" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <!--  Quick Stats  -->
                    <Border
                        Background="#2D2D2D"
                        CornerRadius="12"
                        Padding="16">
                        <StackPanel Spacing="8">
                            <TextBlock
                                FontSize="16"
                                FontWeight="Bold"
                                Foreground="#E0E0E0"
                                HorizontalAlignment="Center"
                                Text="Today's Progress" />
                            <Grid Margin="10,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock
                                        FontSize="20"
                                        FontWeight="Bold"
                                        Foreground="WhiteSmoke"
                                        HorizontalAlignment="Center"
                                        Text="{Binding TotalTasksCount}" />
                                    <TextBlock
                                        FontSize="12"
                                        Foreground="#A0A0A0"
                                        HorizontalAlignment="Center"
                                        Text="Total" />
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="20,0">
                                    <TextBlock
                                        FontSize="20"
                                        FontWeight="Bold"
                                        Foreground="#FF6B6B"
                                        HorizontalAlignment="Center"
                                        Text="{Binding PendingTasksCount}" />
                                    <TextBlock
                                        FontSize="12"
                                        Foreground="#A0A0A0"
                                        HorizontalAlignment="Center"
                                        Text="Pending" />
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock
                                        FontSize="20"
                                        FontWeight="Bold"
                                        Foreground="ForestGreen"
                                        HorizontalAlignment="Center"
                                        Text="{Binding CompletedTasksCount}" />
                                    <TextBlock
                                        FontSize="12"
                                        Foreground="#A0A0A0"
                                        HorizontalAlignment="Center"
                                        Text="Completed" />
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>

        <!--  Main Content  -->
        <Grid Grid.Row="1" Margin="24,24,24,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!--  Left Panel - Add Task  -->
            <Border
                Background="#252525"
                BoxShadow="0 4 16 0 #00000060"
                CornerRadius="16"
                Grid.Column="0"
                Margin="0,0,12,0"
                Padding="20">
                <ScrollViewer Margin="-15,0,-10,0" VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="8,0,20,0" Spacing="16">
                        <TextBlock
                            FontSize="20"
                            FontWeight="Bold"
                            Foreground="#E0E0E0"
                            Text="Add New Task" />

                        <TextBox
                            Classes="modern-input"
                            FontSize="16"
                            Text="{Binding NewTaskTitle}"
                            Watermark="What needs to be done?" />

                        <TextBox
                            AcceptsReturn="True"
                            Classes="modern-input"
                            Height="80"
                            Text="{Binding NewTaskDescription}"
                            Watermark="Add a description (optional)" />

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock
                                FontWeight="SemiBold"
                                Grid.Column="0"
                                Grid.Row="0"
                                Margin="0,0,0,8"
                                Text="Priority" />
                            <ComboBox
                                Classes="modern-combo"
                                Grid.Column="0"
                                Grid.Row="1"
                                Margin="0,0,8,0"
                                SelectedIndex="{Binding NewTaskPriority}">
                                <ComboBoxItem Content="High" />
                                <ComboBoxItem Content="Medium" />
                                <ComboBoxItem Content="Low" />
                            </ComboBox>

                            <TextBlock
                                FontWeight="SemiBold"
                                Grid.Column="1"
                                Grid.Row="0"
                                Margin="0,0,0,8"
                                Text="Category" />
                            <ComboBox
                                Classes="modern-combo"
                                Grid.Column="1"
                                Grid.Row="1"
                                Margin="8,0,0,0"
                                SelectedIndex="{Binding NewTaskCategory}">
                                <ComboBoxItem Content="Academic" />
                                <ComboBoxItem Content="Work" />
                                <ComboBoxItem Content="Personal" />
                                <ComboBoxItem Content="Health" />
                            </ComboBox>
                        </Grid>

                        <StackPanel Orientation="Vertical" Spacing="8">
                            <TextBlock FontWeight="SemiBold" Text="Due Date" />
                            <CalendarDatePicker
                                Background="#2D2D2D"
                                CornerRadius="12"
                                Foreground="#E0E0E0"
                                HorizontalAlignment="Stretch"
                                Padding="16,12"
                                SelectedDate="{Binding NewTaskDueDate}" />
                        </StackPanel>

                        <Button
                            Classes="modern-btn"
                            Command="{Binding AddTaskCommand}"
                            Content="{Binding ButtonText}"
                            FontSize="16"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            Margin="0,8,0,0" />


                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!--  Right Panel - Task List  -->
            <Border
                Background="#252525"
                BoxShadow="0 4 16 0 #00000060"
                CornerRadius="16"
                Grid.Column="1"
                Margin="12,0,0,0"
                Padding="20">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!--  Task List Header  -->
                    <Grid Grid.Row="0" Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock
                            FontSize="20"
                            FontWeight="Bold"
                            Foreground="#E0E0E0"
                            Grid.Column="0"
                            Text="Your Tasks"
                            VerticalAlignment="Center" />

                        <StackPanel
                            Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="8">
                            <ComboBox
                                Background="#2D2D2D"
                                BorderBrush="#3E3E3E"
                                BorderThickness="2"
                                CornerRadius="8"
                                Foreground="#E0E0E0"
                                MinWidth="120"
                                Padding="12,8"
                                SelectedIndex="{Binding FilterIndex}">
                                <ComboBoxItem Content="All Tasks" />
                                <ComboBoxItem Content="Pending" />
                                <ComboBoxItem Content="Completed" />
                                <ComboBoxItem Content="High Priority" />
                            </ComboBox>
                            <Button
                                Background="#EF4444"
                                Classes="modern-btn"
                                Command="{Binding ClearAllTasksCommand}"
                                Content="Clear All"
                                FontSize="12"
                                Padding="12,8" />
                        </StackPanel>
                    </Grid>

                    <!--  Progress Bar  -->
                    <Border
                        Background="#3E3E3E"
                        CornerRadius="8"
                        Grid.Row="1"
                        Height="8"
                        Margin="0,0,0,16">
                        <Border
                            Background="#06D6A0"
                            CornerRadius="8"
                            HorizontalAlignment="Left"
                            Width="{Binding ProgressPercentage, Converter={StaticResource ProgressToWidthConverter}}" />
                    </Border>

                    <!--  Task List  -->
                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <ListBox ItemsSource="{Binding FilteredTasks}" SelectedItem="{Binding SelectedTask}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Classes="task-card">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>

                                                <CheckBox
                                                    Classes="modern-check"
                                                    Grid.Column="0"
                                                    Grid.Row="0"
                                                    Grid.RowSpan="2"
                                                    IsChecked="{Binding IsCompleted}"
                                                    Margin="0,4,16,0"
                                                    VerticalAlignment="Top" />

                                                <TextBlock
                                                    FontSize="16"
                                                    FontWeight="SemiBold"
                                                    Foreground="{Binding IsCompleted, Converter={StaticResource BoolToForegroundConverter}}"
                                                    Grid.Column="1"
                                                    Grid.Row="0"
                                                    Text="{Binding Title}"
                                                    TextDecorations="{Binding IsCompleted, Converter={StaticResource BoolToTextDecorationConverter}}" />

                                                <TextBlock
                                                    FontSize="14"
                                                    Foreground="#A0A0A0"
                                                    Grid.Column="1"
                                                    Grid.Row="1"
                                                    IsVisible="{Binding Description, Converter={StaticResource StringNotEmptyConverter}}"
                                                    Margin="0,4,0,0"
                                                    Text="{Binding Description}" />

                                                <StackPanel
                                                    Grid.Column="1"
                                                    Grid.Row="2"
                                                    Margin="0,8,0,0"
                                                    Orientation="Horizontal"
                                                    Spacing="8">
                                                    <TextBlock Foreground="{Binding Priority, Converter={StaticResource PriorityToColorConverter}}" Text="{Binding Priority}" />
                                                    <TextBlock
                                                        FontSize="12"
                                                        FontWeight="SemiBold"
                                                        Padding="8,4"
                                                        Text="{Binding Category}" />
                                                    <TextBlock
                                                        Background="#3E3E3E"
                                                        FontSize="12"
                                                        Foreground="#E0E0E0"
                                                        Padding="8,4"
                                                        Text="{Binding DueDate, StringFormat='{}{0:MMM dd}'}" />
                                                </StackPanel>

                                                <Button
                                                    Classes="delete-btn"
                                                    Command="{Binding $parent[ItemsControl].((vm:MainWindowViewModel)DataContext).DeleteTaskCommand}"
                                                    CommandParameter="{Binding}"
                                                    Content="Delete"
                                                    Grid.Column="2"
                                                    Grid.Row="0"
                                                    VerticalAlignment="Top" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ListBox>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>